
pkgbase=python-automat
name=('python-automat' 'python2-automat')
version=20.2.0
release=5
# description : "Self-service finite-state machines for the programmer on the go."
             'python2-attrs')

prepare() {
  cp -a automat-$version{,-py2}

  # Set version for setuptools_scm
  export SETUPTOOLS_SCM_PRETEND_VERSION=$version
}

build-remove() {
  cd "$srcdir"/automat-$version
  python setup.py build

  cd "$srcdir"/automat-$version-py2
  python2 setup.py build
}

check() {
  cd "$srcdir"/automat-$version
  python -m pytest --deselect benchmark

  cd "$srcdir"/automat-$version-py2
  python2 -m pytest --deselect benchmark
}

package_python-automat() {
  # depends : ('python-attrs')

  cd automat-$version
  python setup.py install --root=$PKG --optimize=1
}

package_python2-automat() {
  # depends : ('python2-attrs')

  cd automat-$version-py2
  python2 setup.py install --root=$PKG --optimize=1

  mv $PKG/usr/bin/automat-visualize{,2}
}
