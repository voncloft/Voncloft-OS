_name=phpserialize
name=python-phpserialize
version=1.3
release=7
# description : A port of the serialize and unserialize functions of php to python"
# depends :   python  
# tests not included in pypi source:
#https://github.com/mitsuhiko/phpserialize/issues/21
# LICENSE not in any source tarball:
#https://github.com/mitsuhiko/phpserialize/issues/22
#source="https://files.pythonhosted.org/packages/source/${_name::1}/${_name}/${_name}-${version}.tar.gz" 
source="${name}-${version}.tar.gz::https://github.com/mitsuhiko/${_name}/archive/${version}.tar.gz"
        "https://raw.githubusercontent.com/mitsuhiko/${_name}/master/LICENSE" 
             95be97fbe3b8d03ba27aee2d9f5e29ff2923425970103f8b15f13e36beb744e8bc1f9361e89b05d2e9677368b5ab95c5ad84722e3523b3b8574e2d94b69f2d3e  

prepare   {
  mv -v "${_name}-$version" "$name-$version"
  cd "$name-$version"
  # disabling broken test:https://github.com/mitsuhiko/phpserialize/issues/17
  sed -e  s/test_tuple_roundtrips/disabled_test_tuple_roundtrips/  \
      -e  s/test_dumps_dict/disabled_test_dumps_dict/  \
      -i tests.py
}

build   {
  cd "$name-$version"
  python setup.py build
}

check   {
  cd "$name-$version"
  python setup.py test
}

package   {
  cd "$name-$version"
  python setup.py install --skip-build \
    --optimize=1 \
    --prefix=/usr \
    --root=$PKG
  install -vDm 644 ../LICENSE -t "${PKG}/usr/share/licenses/${name}"
}
