
_name=django-fake-model
name=python-$_name
version=0.1.4
release=3
# description : Simple library for creating fake Django models in the unit tests 
# depends :  python-django 
# Not using PyPI source tarball as it does not include tests
source="https://github.com/erm0l0v/django-fake-model/archive/$version/$name-$version.tar.gz"
        django2.diff 
             ffc0baaacf4a0b507ef99fc0975166cb2a36dde061a2be72e91959157183889d  

prepare   {
  cd $_name-$version
  # Fix compatibility with newer Django
  # 1. on_delete is required for ForeignKey since 2.0 [1]
  # 2. Failure in toggling off foreign_keys are reported since 2.2 [2].
  #    The underlying cause is that django.test.TestCase puts the whole test
  #    in a transaction, and toggling foreign_keys in a transaction is not
  #    supported in SQLite. Use django.test.TransactionTestCase to work
  #    around it.
  # [1]https://github.com/django/django/commit/ddd3268975dca9094d94ab1df56dae0a24a58865
  # [2]https://github.com/django/django/commit/315357ad25a6590e7f4564ec2e56a22132b09001
  patch -Np1 -i ../django2.diff
}

build   {
  cd $_name-$version
  python setup.py build
}

check   {
  cd $_name-$version
  python runtests.py tests
}

package   {
  cd $_name-$version
  python setup.py install --root=$PKG --optimize=1 --skip-build
  install -Dm644 LICENSE -t $PKG/usr/share/licenses/$name
}
