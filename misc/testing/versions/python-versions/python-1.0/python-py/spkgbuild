
pkgbase=python-py
name=  python-py   python2-py  
version=1.10.0
release=1
# description : library with cross-python path, ini-parsing, io, code, log facilities"
              python2-setuptools-scm   python-iniconfig   python2-iniconfig 
              python-apipkg   python2-apipkg  
source="$pkgbase-$version.tar.gz::https://github.com/pytest-dev/py/archive/$version.tar.gz"
        py-pytest-4.patch::https://github.com/pytest-dev/py/pull/222.patch 
             cabfdb8cd2e229bfbd5e770a145dde60f9e649f683f8e3d57d2cf393a4d246fcb0eae4596cbbee010de97bfca26470a5dd4280d0f9e34d7f30df19b09f5ea8b6  

prepare   {
  patch -d py-$version -p1 -i ../py-pytest-4.patch || :  # Failures are doc only
  rm -r py-$version/py/_vendored_packages
  cp -a py-$version{,-py2}

  export LC_CTYPE=en_US.UTF-8
  export SETUPTOOLS_SCM_PRETEND_VERSION=$version
}

build   {
  cd "$srcdir"/py-$version
  python setup.py build

  cd "$srcdir"/py-$version-py2
  python2 setup.py build
}

check   {
  # Known failure:https://github.com/pytest-dev/py/issues/104

  cd "$srcdir"/py-$version
  python setup.py pytest || echo "Tests failed"

  cd "$srcdir"/py-$version-py2
  python2 setup.py pytest || echo "Tests failed"
}

package_python-py   {
  # depends :   python-iniconfig   python-apipkg  

  cd py-$version
  python setup.py install --root=$PKG --optimize=1
  install -D -m644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}

package_python2-py   {
  # depends :   python2-iniconfig   python2-apipkg  

  cd py-$version-py2
  python2 setup.py install --root=$PKG --optimize=1
  install -D -m644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}
