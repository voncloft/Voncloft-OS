
pkgbase=python-setuptools-scm
name= python-setuptools-scm python2-setuptools-scm 
version=5.0.1
release=1
# description : Handles managing your python package versions in scm metadata."
               python-toml   python2-toml  
source="https://pypi.io/packages/source/s/setuptools_scm/setuptools_scm-$version.tar.gz" 

prepare   {
  #https://github.com/pypa/setuptools/issues/2466
  sed -i  s/filterwarnings=error/filterwarnings =\n    error\n    ignore:Creating a LegacyVersion has been deprecated and will be removed in the next major release:DeprecationWarning/  \
      setuptools_scm-$version/tox.ini
  sed -i  /jaraco.windows/d  setuptools_scm-$version/{setup.cfg,src/setuptools_scm.egg-info/requires.txt}
  cp -a setuptools_scm-$version{,-py2}
}

build   {
  cd "$srcdir"/setuptools_scm-$version
  python setup.py build
  python setup.py egg_info

  cd "$srcdir"/setuptools_scm-$version-py2
  python2 setup.py build
  python2 setup.py egg_info
}

check   {
  # Hack entry points by installing it

  cd "$srcdir"/setuptools_scm-$version
  python setup.py install --root="$PWD/tmp_install" --optimize=1
  PYTHONPATH="$PWD/tmp_install/usr/lib/python3.9/site-packages:$PYTHONPATH" py.test

  cd "$srcdir"/setuptools_scm-$version-py2
  python2 setup.py install --root="$PWD/tmp_install" --optimize=1
  PYTHONPATH="$PWD/tmp_install/usr/lib/python2.7/site-packages:$PYTHONPATH" py.test2
}

package_python-setuptools-scm   {
  # depends :   python-setuptools  
  provides=  python-setuptools_scm  
  conflicts=  python-setuptools_scm  
  replaces=  python-setuptools_scm  

  cd "$srcdir"/setuptools_scm-$version
  python setup.py install --root $PKG

  install -Dm644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}

package_python2-setuptools-scm   {
  # depends :   python2-setuptools  
  provides=  python2-setuptools_scm  
  conflicts=  python2-setuptools_scm  
  replaces=  python2-setuptools_scm  

  cd "$srcdir"/setuptools_scm-$version-py2
  python2 setup.py install --root $PKG

  install -Dm644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}
