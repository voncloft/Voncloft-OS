
name=python-snappy
version=0.6.0
release=1
# description : Python bindings for the snappy compression library. 
# depends :  python snappy 
source=https://files.pythonhosted.org/packages/source/p/python-snappy/python-snappy-$version.tar.gz 

prepare   {
  cd $name-$version
  # Move test scripts around, so that they can use the correct sys.path  build/lib.linux... 
  mkdir tests
  mv test_*.py tests
}

build   {
  cd $name-$version
  python setup.py build
}

check   {
  cd $name-$version
  pyver=$ python -c "import sys; print  {}.{} .format *sys.version_info[:2]  " 
  export PYTHONPATH="$PWD/build/lib.linux-$CARCH-$pyver"
  # Avoid writing .pyc files in check  , or packaging with --nocheck cannot reproduce
  # packages built with check   as .pyc files created in check   embed $srcdir
  PYTHONDONTWRITEBYTECODE=1 pytest tests --ignore=tests/test_snappy_cffi.py
}

package   {
  cd $name-$version
  python setup.py install --root=$PKG --optimize=1 --skip-build
  install -D -m644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}
