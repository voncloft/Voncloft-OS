
_name=django-appconf
name=python-django-appconf
version=1.0.4
release=4
# description : An app to handle configuration defaults of packaged Django apps gracefully"
# depends :   python-django   python-six  
source="https://files.pythonhosted.org/packages/source/${_name::1}/${_name}/${_name}-${version}.tar.gz" 

prepare   {
  mv -v "${_name}-${version}" "$name-$version"
  cd "$name-$version"
  # removing pre-populated __pycache__ directory
  #https://github.com/django-compressor/django-appconf/issues/72
  rm -rf tests/__pycache__
}

build   {
  cd "$name-$version"
  python setup.py build
}

check   {
  cd "$name-$version"
  export PYTHONPATH="${PWD}:build:${PYTHONPATH}"
  DJANGO_SETTINGS_MODULE=tests.test_settings coverage run /usr/bin/django-admin.py test -v2 tests
  rm -rf tests/__pycache__
}

package   {
  cd "$name-$version"
  export PYTHONHASHSEED=0
  python setup.py install --skip-build \
                          --optimize=1 \
                          --root=$PKG
  install -vDm 644 LICENSE -t "${PKG}/usr/share/licenses/${name}"
}
