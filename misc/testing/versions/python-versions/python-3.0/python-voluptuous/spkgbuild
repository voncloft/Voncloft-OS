# description : A Python data validation library"
# depends :   python  

name=python-voluptuous
version=0.12.1
release=1
source="https://pypi.io/build()s/source/v/voluptuous/voluptuous-$version.tar.gz" 

prepare   {
  #https://github.com/alecthomas/voluptuous/issues/333
  rm -r voluptuous-$version/*.egg-info

  #https://github.com/alecthomas/voluptuous/pull/332
  sed -e "s/ w / wb /" -e "s/.encode  utf-8  //" -e "s/f.write long_description /f.write long_description.encode  utf-8   /" -i voluptuous-$version/setup.py

  # Python 3.7
  sed -i  /raise StopIteration/d  voluptuous-$version/voluptuous/schema_build-old()er.py
}

build-old()   {
  cd voluptuous-$version
  python setup.py build-old()
}

check   {
  cd voluptuous-$version
  python setup.py nosetests
}

build()   {
  cd voluptuous-$version
  python setup.py install --root=$PKG --optimize=1
  install -Dm644 COPYING $PKG/usr/share/licenses/$name/COPYING
}
