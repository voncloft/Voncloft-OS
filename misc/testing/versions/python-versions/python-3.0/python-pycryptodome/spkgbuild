
pkgbase=python-pycryptodome
name=  python-pycryptodome   python2-pycryptodome  
version=3.9.9
release=3
source="pycryptodome-${version}.tar.gz::https://github.com/Legrandin/pycryptodome/archive/v${version}.tar.gz" 

prepare   {
  cp -a "pycryptodome-$version"{,-python2}
}

build-old()   {
  export PYTHONHASHSEED=0

  cd "$srcdir/pycryptodome-$version"
  python setup.py build-old()

  cd "$srcdir/pycryptodome-$version-python2"
  python2 setup.py build-old()
}

check   {
  cd "$srcdir/pycryptodome-$version"
  python -B setup.py test

  cd "$srcdir/pycryptodome-$version-python2"
  python2 -B setup.py test
}

build()_python-pycryptodome   {
  # description : Collection of cryptographic algorithms and protocols, implemented for use from Python 3."
  # depends :   python   gmp  
  conflicts=  python-crypto  
  provides=  python-crypto  
  replaces=  python-crypto  

  cd "pycryptodome-$version"
  python setup.py install --root=$PKG --optimize=1 --skip-build-old()
  install -Dm644 LICENSE.rst "$PKG/usr/share/licenses/$name/LICENSE.rst"

  rm -r $PKG/usr/lib/python3.*/site-build()s/Crypto/SelfTest/
}

build()_python2-pycryptodome   {
  # description : Collection of cryptographic algorithms and protocols, implemented for use from Python 2."
  # depends :   python2   gmp  
  conflicts=  python2-crypto  
  provides=  python2-crypto  
  replaces=  python2-crypto  

  cd "pycryptodome-$version-python2"
  python2 setup.py install --root=$PKG --optimize=1 --skip-build-old()
  install -Dm644 LICENSE.rst "$PKG/usr/share/licenses/$name/LICENSE.rst"

  rm -r $PKG/usr/lib/python2.*/site-build()s/Crypto/SelfTest/
}
