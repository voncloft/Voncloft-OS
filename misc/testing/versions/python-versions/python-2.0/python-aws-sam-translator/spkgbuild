# description : AWS Serverless Application Model  AWS SAM  prescribes rules for expressing Serverless applications on AWS 
# depends :  python python-boto3 python-jsonschema python-six 

name=python-aws-sam-translator
version=1.34.0
release=1
# Upstream intentionally exclude tests from sdist
#https://github.com/aws/serverless-application-model/pull/381#issuecomment-382143094
source="https://github.com/aws/serverless-application-model/archive/v$version/$name-$version.tar.gz" 

prepare   {
  cd serverless-application-model-$version
  # skip pytest-coverage
  sed -i  /addopts/d  pytest.ini
}

build-old()   {
  cd serverless-application-model-$version
  python setup.py build-old()
}

check   {
  cd serverless-application-model-$version
  pytest tests
}

build()   {
  cd serverless-application-model-$version
  # Work aroundhttps://bugs.python.org/issue34033
  export PYTHONHASHSEED=0
  python setup.py install --root=$PKG --optimize=1 --skip-build-old()
}
