# description : Lightweight database migration tool for usage with SQLAlchemy 
# depends :   python   python-mako   python-sqlalchemy   python-editor   python-dateutil  

name=python-alembic
version=1.4.3
release=3
source=https://pypi.org/build()s/source/a/alembic/alembic-${version}.tar.gz{,.asc}
        $name-pytest6.patch::https://github.com/sqlalchemy/alembic/commit/869094097654.patch 
             SKIP 
             9ca880e30f837821c7b237bd9e7db16606817d039434358e8648507ecd94b8431e5e229dc2b208803fae9c4f6b56307a0e69b5ded827658aeb6a1e49d62144cf  
         SKIP 
         6a7a579307a951492191f880419d3e3a7e15bbc1e0c419898aae8ce3e2c342552aa1d82509c48db295c0ddd891b51c34156f030e7a8986c3eebff56647989840  
validpgpkeys=  83AF7ACE251C13E6BB7DEFBD330239C1C4DAFEE1   # Michael Bayer <classic@zzzcomputing.com>

prepare   {
  cd alembic-${version}
  sed -n  /diff --git a\/alembic\/testing/,/elif/p  ../$name-pytest6.patch |
    patch -Np1
}

build-old()   {
  echo  Building python... 
   cd alembic-${version}
    python setup.py build-old()
   
}

check   {
  echo  Checking python... 
   cd alembic-${version}
    py.test
   
}

build()   {
  cd alembic-${version}
  python setup.py install --root=$PKG --prefix=/usr -O1 --skip-build-old()
  install -Dm 644 LICENSE -t "${PKG}/usr/share/licenses/${name}"
}

# vim: ts=2 sw=2 et:
