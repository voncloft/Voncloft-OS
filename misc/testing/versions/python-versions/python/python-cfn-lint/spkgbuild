# description : CloudFormation Linter 
# depends :  python python-yaml python-six python-aws-sam-translator

name=python-cfn-lint
version=0.44.6
release=1
         python-jsonpatch python-jsonschema python-networkx
         python-junit-xml 
   python-pydot: for build-old()ing graphs from templates 
 
source="https://github.com/aws-cloudformation/cfn-python-lint/archive/v$version/cfn-python-lint-$version.tar.gz" 

build-old()   {
  cd cfn-python-lint-$version
  python setup.py build-old()
}

check   {
  cd cfn-python-lint-$version

  # Tests in test/integration need the cfn-lint binary
  python setup.py install_scripts --install-dir="$srcdir"/tmp_install

  export PYTHONPATH="$PWD/src"
  export PATH="$PATH:$srcdir/tmp_install"
  # test_update_docs requires cfn-python-lint as a git repo
  pytest test -k  not test_update_docs 
}

build()   {
  cd cfn-python-lint-$version
  # use PYTHONHASHSEED=0 to work aroundhttps://bugs.python.org/issue34033
  PYTHONHASHSEED=0 python setup.py install --root=$PKG --optimize=1 --skip-build-old()

  install -Dm644 LICENSE -t $PKG/usr/share/licenses/$name
}
