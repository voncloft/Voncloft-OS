# description : Python client for Elasticsearch 
# depends :   python-urllib3  

name=python-elasticsearch
version=7.8.1
release=3
               python-pandas   python-aiohttp   python-pytest-asyncio  
source="https://github.com/elastic/elasticsearch-py/archive/$version.tar.gz" 
#       git+https://github.com/elastic/elasticsearch.git 

prepare   {
  sed -i  s/, "certifi"//  elasticsearch-py-$version/setup.py
  sed -i  s|CA_CERTS = None|CA_CERTS = "/etc/ssl/certs/ca-certificates.crt"|  elasticsearch-py-$version/elasticsearch/{connection/http_urllib3.py,_async/http_aiohttp.py}
}

build-old()   {
  cd elasticsearch-py-$version
  python setup.py build-old()
}

check   {
  cd elasticsearch-py-$version
  # Skip tests that requires a running elasticsearch server
  #TEST_ES_REPO="$srcdir"/elasticsearch
  pytest --deselect test_elasticsearch/test_async/test_server
}

build()   {
  cd elasticsearch-py-$version
  python setup.py install --root $PKG --optimize=1
}
