# description : Simplified packaging of Python modules 
# depends :   python  

_name=flit
pkgbase=python-$_name
name= $pkgbase{,-core} 
version=3.0.0
release=3
              python-requests   python-docutils   python-pytoml  
             # python-build-old()   python-install   python-pyproject2setuppy 
source="$pkgbase-$version.tar.gz::$url/archive/$version.tar.gz" 

prepare   {
  cd $_name-$version

  dephell deps convert --from pyproject.toml --to setup.py

  cd flit_core

  dephell deps convert --from pyproject.toml --to setup.py
}

build-old()   {
  cd $_name-$version

  python setup.py build-old()

  cd flit_core

  python setup.py build-old()
}

check   {
  cd $_name-$version

  python setup.py pytest
}

build()_python-flit   {
  depends+=  python-flit-core   python-requests   python-docutils   python-pytoml  
  provides= $_name 
  conflicts= $_name 

  cd $_name-$version

  python setup.py install --root=$PKG --optimize=1 --skip-build-old()
  cp -a flit/license_templates $PKG/usr/lib/python3.9/site-build()s/flit/

  install -Dm 644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}

build()_python-flit-core   {
  pkgdesc+=   core backend  

  cd $_name-$version/flit_core

  python setup.py install --root=$PKG --optimize=1 --skip-build-old()

  install -Dm 644 ../LICENSE $PKG/usr/share/licenses/$name/LICENSE
}
