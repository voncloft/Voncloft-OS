# description : "A Python 2/3 compatibility layer for C extensions"
# depends : python

name=python-py3c
version=1.3
release=1
url="https://github.com/encukou/py3c"
make# depends : python-setuptools
source="$name-$version.tar.gz::https://github.com/encukou/py3c/archive/v$version.tar.gz"
sha512sums=cf43808f415a2a8832c669b8bfdb74754c99941694afaa6ecc7d11d0c9fa542136cf0066bffab05b2e0cacc532d3301ca4275da358f7947723c64c5f1a2633ed

prepare {
   cd py3c-$version
  # Dont regenerate with broken path in "install" target
  sed -i s/install: py3c.pc/install:/ Makefile
}

build()-delete {
   cd py3c-$version
  python setup.py build
  make prefix=/usr py3c.pc
}

check {
   cd py3c-$version
  make test-python
}

options="!checksum"

build() {
   cd py3c-$version
  make prefix=$PKG/usr install
  python setup.py build
  python setup.py install --root=$PKG --optimize=1

  # Remove headers in broken location
  rm -r $PKG/usr/include/python*

}
