# description : A tool for converting between pip-style and pipfile requirements"
# depends :   python-appdirs   python-attrs   python-cached-property   python-distlib 

name=python-requirementslib
version=1.5.16
release=1
          python-orderedmultidict   python-packaging   python-pep517   python-pip-shims 
          python-plette   python-cerberus   python-dateutil   python-requests   python-setuptools 
          python-tomlkit   python-vistir  
               python-pytest-xdist   python-hypothesis  
source="https://github.com/sarugaku/requirementslib/archive/$version.tar.gz"
        "git+https://github.com/kennethreitz/requests.git#commit=64bde6582d9b49e9345d9b8df16aaa26dc372d13"
        "git+https://github.com/sarugaku/shellingham.git#commit=9abe7464dab5cc362fe08361619d3fb15f2e16ab" 
             SKIP 
             SKIP  

prepare   {
  cd requirementslib-$version
  sed -i  s/pkg_resources.extern.//  src/requirementslib/models/*.py

  #https://github.com/sarugaku/requirementslib/issues/181
  sed -e  s/list MARKER_OP /MARKER_OP.exprs/  -e  s/list VARIABLE /VARIABLE.exprs/  -i tests/unit/strategies.py

  #https://github.com/sarugaku/requirementslib/issues/183
  sed -i  s/not isinstance source\["verify_ssl"\], bool /isinstance source["verify_ssl"], str /  -i src/requirementslib/models/pipfile.py

  cd tests/artifacts/git
  rmdir requests shellingham
  ln -s "$srcdir"/requests
  ln -s "$srcdir"/shellingham
}

build-old()   {
  cd requirementslib-$version
  python setup.py build-old()
}

check   {
  cd requirementslib-$version
  python setup.py pytest || echo "Tests failed"
}

build()   {
  cd requirementslib-$version
  python setup.py install --root=$PKG --optimize=1

  install -Dm644 LICENSE -t $PKG/usr/share/licenses/$name/
}
