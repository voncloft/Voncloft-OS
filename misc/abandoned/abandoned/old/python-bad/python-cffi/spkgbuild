# description : "Foreign Function Interface for Python calling C code"

pkgbase=python-cffi
name=(python-cffi python2-cffi)
version=1.14.4
release=1

prepare() {
  cp -a cffi-v$version{,-py2}
}

build-remove() {
  cd "$srcdir"/cffi-v$version
  python setup.py build

  cd "$srcdir"/cffi-v$version-py2
  python2 setup.py build
}

check() {
  cd "$srcdir"/cffi-v$version
  python setup.py pytest

  cd "$srcdir"/cffi-v$version-py2
  python2 setup.py pytest
}

package_python-cffi() {
  # depends : ('python-pycparser')

  cd cffi-v$version

  # remove files created during check() for reproducible SOURCES.txt
  rm -rf testing/cffi{0,1}/__pycache__/

  python setup.py install --root=$PKG --optimize=1
}

package_python2-cffi() {
  # depends : ('python2-pycparser')

  cd cffi-v$version-py2

  # remove files created during check() for reproducible SOURCES.txt
  rm -rf testing/cffi{0,1}/__pycache__/

  python2 setup.py install --root=$PKG --optimize=1
}
