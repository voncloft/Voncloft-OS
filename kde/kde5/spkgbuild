# description : kde meta basically installs all of kde
# depends : kde-deps kf5-programs plasma-programs

name=kde5
version=5
release=1
_version=5.77
build () {
	mkdir -pv $PKG/opt/kf5-$_version

	 cat <<- EOF > $PKG/etc/profile.d/kf5.sh
        # Begin /etc/profile.d/kf5.sh

        export KF5_PREFIX=/opt/kf5

        pathappend $KF5_PREFIX/bin              PATH
        pathappend $KF5_PREFIX/lib/pkgconfig    PKG_CONFIG_PATH

        pathappend $KF5_PREFIX/etc/xdg          XDG_CONFIG_DIRS
        pathappend $KF5_PREFIX/share            XDG_DATA_DIRS

        pathappend $KF5_PREFIX/lib/plugins      QT_PLUGIN_PATH
        pathappend $KF5_PREFIX/lib/plugins/kcms QT_PLUGIN_PATH

        pathappend $KF5_PREFIX/lib/qml          QML2_IMPORT_PATH

        pathappend $KF5_PREFIX/lib/python3.8/site-packages PYTHONPATH

        pathappend $KF5_PREFIX/share/man        MANPATH
        # End /etc/profile.d/kf5.sh
        EOF

        cat <<- EOF > $PKG/etc/profile.d/qt5.sh
        # Begin Qt5 changes for KF5

        pathappend $QT5DIR/plugins             QT_PLUGIN_PATH
        pathappend $QT5DIR/qml                 QML2_IMPORT_PATH

        # End Qt5 changes for KF5
        EOF

        cat <<-EOF > $PKG/etc/ld.so.conf
        # Begin KF5 addition

        /opt/kf5/lib

        # End KF5 addition
        EOF

        install -v -dm755           $PKG/opt/kf5-$_version/{etc,share}
        ln -sfv /etc/dbus-1         $PKG/opt/kf5-$_version/etc
        ln -sfv /usr/share/dbus-1   $PKG/opt/kf5-$_version/share
        install -v -dm755           $PKG/opt/kf5-$_version/share/icons &&
        ln -sfv /usr/share/icons/hicolor $PKG/opt/kf5-$_version/share/icons

 	#mkdir -pv $PKG/opt/kf5
 	#ln -sfvn /opt/kf5-$_version $PKG/opt/kf5

	

	install -dvm 755 $PKG/usr/share/xsessions              &&
	cd $PKG/usr/share/xsessions/                                   &&
	[ -e plasma.desktop ]                                      ||
	ln -sfv $PKG/opt/kf5/share/xsessions/plasma.desktop &&
	install -dvm 755 $PKG/usr/share/wayland-sessions       &&
	cd $PKG/usr/share/wayland-sessions/                            &&
	[ -e plasmawayland.desktop ]                               ||
	ln -sfv $PKG/opt/kf5/share/wayland-sessions/plasmawayland.desktop


	cat <<- EOF > $PKG/etc/pam.d/kde 
	# Begin /etc/pam.d/kde

	auth     requisite      pam_nologin.so
	auth     required       pam_env.so

	auth     required       pam_succeed_if.so uid >= 1000 quiet
	auth     include        system-auth

	account  include        system-account
	password include        system-password
	session  include        system-session

	# End /etc/pam.d/kde
	EOF

	cat <<-EOF > $PKG/etc/pam.d/kde-np 
	# Begin /etc/pam.d/kde-np

	auth     requisite      pam_nologin.so
	auth     required       pam_env.so

	auth     required       pam_succeed_if.so uid >= 1000 quiet
	auth     required       pam_permit.so

	account  include        system-account
	password include        system-password
	session  include        system-session

	# End /etc/pam.d/kde-np
	EOF

	cat <<-EOF > $PKG/etc/pam.d/kscreensaver
	# Begin /etc/pam.d/kscreensaver

	auth    include system-auth
	account include system-account

	# End /etc/pam.d/kscreensaver
	EOF
}
