# description : Associate user-defined magic to variables from Perl.
# depends : perl

name=perl-variable-magic
_cpanname=Variable-Magic
version=0.62
release=5
url=https://search.cpan.org/dist/$_cpanname
source="https://search.cpan.org/CPAN/authors/id/V/VP/VPIT/$_cpanname-$version.tar.gz"
options="!checksum"

# Function to change to the working directory and set
# environment variables to override undesired options.
prepareEnvironment {
  cd $srcdir/$_cpanname-$version
  export \
    PERL_MM_USE_DEFAULT=1 \
    PERL_AUTOINSTALL=--skipdeps \
    PERL_MM_OPT=INSTALLDIRS=vendor DESTDIR=${PKG//\/\\\} \
    PERL_MB_OPT=--installdirs vendor --destdir ${PKG//\/\\\} \
    MODULEBUILDRC=/dev/null
}
sha256sums=3f9a18517e33f006a9c2fc4f43f01b54abfe6ff2eae7322424f31069296b615c

build-delete {
  prepareEnvironment
  /usr/bin/perl Makefile.PL
  make
}

check {
  prepareEnvironment
  make test
}

build() {
  prepareEnvironment
  make install

  # Remove perllocal.pod and .packlist.
  find $PKG -name .packlist -o -name perllocal.pod -delete
}
build() {
   cd
   perl Makefile.PL
   make
   make DESTDIR=$PKG install
}
