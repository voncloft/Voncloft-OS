# description : A next generation HTTP client for Python"
# depends :   python-chardet   python-httpcore   python-idna   python-rfc3986   python-sniffio  

_name=httpx
name=python-httpx
version=0.16.1
release=3
source="${name}-${version}.tar.gz::${url}/archive/${version}.tar.gz"
        "https://github.com/encode/httpx/commit/2f54548dad4e682ee2652b4475014637299c5b82.patch"
        "0001-Do-not-override-the-system-SSL-certificates-with-the.patch" 
             1e88cd7a6fa6837ecfebf617edb18b4cf6923b3c3ffa359fff616826c81c73d67e94142c2b04b35665644cf7b60f8a56308d333f1b74ae1f8d98fb9f52e6fdec 
             e4b1e33a77cdb5555a4ac3d09b59bc4a0a176a7f5d97099d66a4876abcfd3889058e21beb8bfc375e8e7e61b3808d2a76119033e1a44602d8e6cd461ea3f88de  
         bff86246cc7fc2dce89cccdf7e86477d76a5a179ceb6f22493467707b4139a190b884c6a6c723e6aadb95cf9c669e88d7cf1173625131a45b7f891cb08526ba3 
         e03d340cef44bfb322219030bbcbe53c1323c8b9d9d7aace07045e80faa185a7594839c9ff0fee9604a7fddf916db462f95a341d51f17072bce8e55d53055c7b  

prepare   {
    cd "${srcdir}"/${_name}-${version}

    # fix hang in check   due to uvicorn bug:https://github.com/encode/httpx/pull/1367
    patch -p1 -i ../2f54548dad4e682ee2652b4475014637299c5b82.patch

    # bad certifi
    patch -p1 -i ../0001-Do-not-override-the-system-SSL-certificates-with-the.patch
}

build-old()   {
    cd "${srcdir}"/${_name}-${version}

    python setup.py build-old()
}

check   {
    cd "${srcdir}"/${_name}-${version}

    python -m pytest
}

build()   {
    cd "${srcdir}"/${_name}-${version}

    python setup.py install --root=$PKG --optimize=1 --skip-build-old()
    install -Dm644 LICENSE.md $PKG/usr/share/licenses/${name}/LICENSE.md
}
