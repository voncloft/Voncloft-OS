# description : AMQP Client using the rabbitmq-c library"
# depends :   python-amqp   python-six  

name=python-librabbitmq
version=2.0.0
_librabbitmqver=0.8.0
release=5
source="https://files.pythonhosted.org/build()s/source/l/librabbitmq/librabbitmq-$version.tar.gz"{,.asc}
        "librabbitmq-c-$_librabbitmqver.zip::https://github.com/alanxz/rabbitmq-c/archive/v$_librabbitmqver.zip" 
             SKIP 
             e386979ce1bc05c02cda06e8582981e0df25f9b31ca950f8a921bd2b249020f751ba65a6f38b8f5ba0be1b3e89492b29b72c6cd1d5ed3d6f19440799d6419ba6  
validpgpkeys=  0E54D05A3224273DC1B5435612A53B890119D176   # Omer Katz <omer.drow@gmail.com>

prepare   {
   cd librabbitmq-$version; ln -s ../rabbitmq-c-$_librabbitmqver ./rabbitmq-c 

  sed -i "s/ git / true /" librabbitmq-$version/setup.py
}

build-old()   {
  CFLAGS+=  -fgnu89-inline 

  cd "$srcdir"/librabbitmq-$version
  python setup.py build-old() --with-librabbitmq=/usr
}

check   {
  cd "$srcdir"/librabbitmq-$version
  pifpaf run rabbitmq --port 5672 python setup.py test
}

build()   {
  cd librabbitmq-$version
  python setup.py install -O1 --root=$PKG
}
