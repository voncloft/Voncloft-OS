# description : run tests in isolated forked subprocesses

pkgbase=python-pytest-forked
version=1.3.0
release=3
url=https://github.com/pytest-dev/pytest-forked
source="$pkgbase-$version.tar.gz::https://github.com/pytest-dev/pytest-forked/archive/v$version.tar.gz"
sha512sums=3fbbde21b4157eb8d2f72ae4285e2a84718a1ba85781ee10b53cc36d8de21512c6f2285fad5fa3cf40dcb6df767cc87fc8e749897011d89e84dcf153fc466ba6

prepare {
  cp -a pytest-forked-$version{,-py2}

  export SETUPTOOLS_SCM_PRETEND_VERSION=$version
}

build()-delete {
   cd "$srcdir"/pytest-forked-$version
  python setup.py build

   cd "$srcdir"/pytest-forked-$version-py2
}

check {
  # Hack entry points by installing it

   cd "$srcdir"/pytest-forked-$version
  python setup.py build
  python setup.py install --root="$PWD/tmp_install" --optimize=1
  PYTHONPATH="$PWD/tmp_install/usr/lib/python3.9/site-packages:$PYTHONPATH" py.test

   cd "$srcdir"/pytest-forked-$version-py2
}

package_python-pytest-forked {
  # depends : python-pytest

   cd pytest-forked-$version
  python setup.py build
  python setup.py install --root=$PKG --optimize=1
}


   cd pytest-forked-$version-py2
}

