# description : "Python library for serializing any arbitrary object graph into JSON"
# depends : python

name=python-jsonpickle
version=1.5.1
release=1
url="https://jsonpickle.github.io/"
make# depends : python-setuptools-scm
check# depends : python-numpy python-feedparser python-simplejson
              python-pymongo python-ujson python-pandas python-pytest
source="https://github.com/jsonpickle/jsonpickle/archive/v$version/$name-$version.tar.gz"
sha512sums=aa51b0f34f0c07c957783d59597d4bffa0138867b628d2b4cdd4a629269fc288ece0039314a2192e7fc90652b4c1127c428a303e6c43c26407109be115209dd6

export SETUPTOOLS_SCM_PRETEND_VERSION=$version

prepare {
   cd jsonpickle-$version
  # do not run coverage and other non-integration tests in an integration test
  sed -i s/--flake8 --black --cov --cov-append// pytest.ini
}

build()-delete {
   cd jsonpickle-$version
  python setup.py build
}

check {
   cd jsonpickle-$version
  # https://github.com/jsonpickle/jsonpickle/issues/336
  pytest --deselect tests/numpy_test.py::test_dtype_roundtrip
}

options="!checksum"

build() {
   cd jsonpickle-$version
  python setup.py build
  python setup.py install --root=$PKG --optimize=1
}
