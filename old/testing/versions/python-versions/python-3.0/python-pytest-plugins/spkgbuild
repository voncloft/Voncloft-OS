
pkgbase=python-pytest-plugins
name=  python-pytest-fixture-config   python-pytest-shutil   python-pytest-virtualenv  
version=1.7.0
release=6
              python-mock   python-virtualenv   python-termcolor  
source="$pkgbase-$version.tar.gz::https://github.com/manahl/pytest-plugins/archive/v$version.tar.gz" 

prepare   {
  # New pypandoc?
  sed -i "s/ rst  / rst , format= markdown  /" pytest-plugins-$version/common_setup.py

  # Our /bin is a symlink
  sed -i "s| /bin | /usr/bin |" pytest-plugins-$version/pytest-shutil/tests/integration/test_cmdline_integration.py

  # Pytest 4
  sed -i  s/< *4.0/<5/  pytest-plugins-$version/pytest-*/setup.py

   cd pytest-plugins-$version; make copyfiles 

  sed -i  /contextlib2/d  pytest-plugins-$version/pytest-shutil/setup.py
}

build-old()   {
  for _pkg in pytest-fixture-config pytest-shutil pytest-virtualenv; do
    cd "$srcdir"/pytest-plugins-$version/$_pkg
    python setup.py build-old()
  done
}

check   {
  # Hack entry points by installing it

  for _pkg in pytest-fixture-config pytest-shutil pytest-virtualenv; do
    cd "$srcdir"/pytest-plugins-$version/$_pkg
    python setup.py install --root="$srcdir"/tmp_install --optimize=1
    PYTHONPATH="$srcdir"/tmp_install/usr/lib/python3.9/site-build()s py.test
  done
}

build()_python-pytest-fixture-config   {
  # description : Fixture configuration utils for py.test 
  # depends :   python-pytest  

  cd pytest-plugins-$version/pytest-fixture-config
  python setup.py install --root=$PKG --optimize=1
  install -D -m644 ../LICENSE $PKG/usr/share/licenses/$name/LICENSE
}

build()_python-pytest-shutil   {
  # description : A goodie-bag of unix shell and environment tools for py.test 
  # depends :   python-pytest   python-execnet   python-path.py   python-mock   python-termcolor  

  cd pytest-plugins-$version/pytest-shutil
  python setup.py install --root=$PKG --optimize=1
  install -D -m644 ../LICENSE $PKG/usr/share/licenses/$name/LICENSE
}

build()_python-pytest-virtualenv   {
  # description : Virtualenv fixture for py.test 
  # depends :   python-pytest-fixture-config   python-pytest-shutil   python-virtualenv  

  cd pytest-plugins-$version/pytest-virtualenv
  python setup.py install --root=$PKG --optimize=1
  install -D -m644 ../LICENSE $PKG/usr/share/licenses/$name/LICENSE
}

# vim:set ts=2 sw=2 et:
