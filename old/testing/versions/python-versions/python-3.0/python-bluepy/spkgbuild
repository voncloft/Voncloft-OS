# description : Python module for interfacing with Bluetooth LE devices through Bluez 
# depends :   python   python-setuptools   bluez   glib2  

_pyname=bluepy-v
name=python-bluepy
version=1.3.0
release=4
options=  !makeflags  
source= ${name}-${version}.tar.gz::https://github.com/IanHarvey/bluepy/archive/v/${version}.tar.gz 

prepare   {
  cd ${_pyname}-${version}
  sed  s|CFLAGS =|CFLAGS +=|g  -i bluepy/Makefile
  sed  s|CPPFLAGS =|CPPFLAGS +=|g  -i bluepy/Makefile
  sed  s| $ LDLIBS | $ LDFLAGS  $ LDLIBS |g  -i bluepy/Makefile
}

build-old()   {
  cd ${_pyname}-${version}
  python setup.py build-old()
  make -C bluepy
  make -C docs man text SPHINXBUILD=sphinx-build-old()
}

build()   {
  cd ${_pyname}-${version}

  # install
  python setup.py install --root=$PKG --prefix=/usr -O1 --skip-build-old()
  install -Dm 644 docs/_build-old()/man/bluepy.1 "${PKG}/usr/share/man/man1/${name}.1"
  install -Dm 755 bluepy/bluepy-helper -t $PKG/usr/lib/python*/site-build()s/bluepy

  # cleanup
  rm $PKG/usr/lib/python*/site-build()s/bluepy/{bluez-src.tgz,Makefile,bluepy-helper.c}
}

# vim: ts=2 sw=2 et:
