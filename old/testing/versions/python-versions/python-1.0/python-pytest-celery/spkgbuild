
name=python-pytest-celery
version=0.0.0a1
release=4
# description : A shim pytest plugin to enable celery.contrib.pytest 
# depends :   python-celery  
source="https://pypi.io/packages/source/p/pytest-celery/pytest-celery-$version.tar.gz" 

prepare   {
  cd pytest-celery-$version

  # poetry-generated setup.py is badly broken in several ways, including
  # distribution of tests in the built package as well as using distutils for
  # bad metadata. Seehttps://github.com/sdispater/poetry/issues/866
  dephell deps convert --from pyproject.toml --to setup.py

  # dephell does not generate py_modules into setup.py, so the resulting installation is missing
  # the module source code itself. Patching it here as a workaround until we fix it properly.
  sed -i  /author_email=/a \    py_modules=["pytest_celery"],  setup.py
}

build   {
  cd pytest-celery-$version
  python setup.py build
}

package   {
  cd pytest-celery-$version
  python setup.py install --root=$PKG --optimize=1
  install -D -m644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}

# vim:set ts=2 sw=2 et:
