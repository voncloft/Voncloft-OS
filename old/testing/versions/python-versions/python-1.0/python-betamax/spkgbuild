
pkgbase=python-betamax
name=python-betamax
version=0.8.1
release=7
# description : A VCR imitation for python-requests"
# depends :   python-requests  
source="https://github.com/sigmavirus24/betamax/archive/$version.tar.gz"
        betamax-pytest4.patch::"https://github.com/betamaxpy/betamax/commit/165cc321.patch" 
             258bd6729286dc9374829308c23cca73ea640c4597ca8747ebb8281bcf7723bba3dfee5b55cadff0459e8dc4511d85228d37911e981859dd0af55a3753ae9e22  

prepare   {
   cd betamax-$version
   patch -p1 -i ../betamax-pytest4.patch # Fix tests with pytest 4
   # Disable some failing tests; taken from Gentoo
   sed -i -e  s:test_records:_&:  -e  s:test_replaces:_&:  -e  s:test_replays:_&:  \
     tests/integration/test_record_modes.py
   
}

check   {
  cd "$srcdir"/betamax-$version
  python setup.py pytest
}

package   {
  cd betamax-$version
  python setup.py install --root=$PKG --optimize=1
  install -D -m644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}
