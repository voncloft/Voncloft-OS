
name=python-cbor
version=1.0.0
release=6
# The commit that bumps cbor/VERSION.py to 1.0.0
_commit=b3af679e7cf3e12d50acb83c3c591fc5db9a658d
# description : CBOR rfc7049 for Python 
# depends :  python 
source="$name-$version.tar.gz"::"https://github.com/brianolson/cbor_py/archive/$_commit.tar.gz" 

prepare   {
  cd cbor_py-$_commit
  sed -i  s#logger.warn #logger.warning #  cbor/tests/*.py
}

build   {
  cd cbor_py-$_commit
  python setup.py build
}

check   {
  cd cbor_py-$_commit
  pyver=$ python -c "import sys; print  {}.{} .format *sys.version_info[:2]  " 
  # test_sortkeys is brokenhttps://github.com/brianolson/cbor_py/issues/6
  PYTHONPATH=build/lib.linux-$CARCH-$pyver pytest -k  not test_sortkeys 
}

package   {
  cd cbor_py-$_commit
  python setup.py install --root=$PKG --optimize=1 --skip-build
}
