
_name=build
name=python-$_name
version=0.1.0
release=2
# description : A simple, correct PEP517 package builder 
# depends :   python-toml   python-pep517   python-packaging  
              python-sphinx   python-sphinxcontrib-autoprogram   python-sphinx-autodoc-typehints   python-sphinx-furo  
validpgpkeys=  3DCE51D60930EBA47858BA4146F633CBB0EB4BF2   # Filipe La√≠ns  FFY00  <lains@archlinux.org>

build   {
  cd $_name

  python setup.py build

  cd docs

  PYTHONPATH=../src sphinx-build -b dirhtml -v source build/html
}

package   {
  cd $_name

  python setup.py install --root=$PKG --skip-build
  python -m compileall --invalidation-mode=checked-hash $PKG

  install -dm 755 $PKG/usr/share/doc/$name
  cp -r -a --no-preserve=ownership docs/build/html $PKG/usr/share/doc/$name
  rm -rf $PKG/usr/share/doc/$name/html/.doctrees

  install -Dm 644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}
