# description : A Python library for parsing and creating TOML"

_name=toml
pkgbase=python-toml
name=  python-toml   python2-toml  
version=0.10.2
release=3
source="https://files.pythonhosted.org/build()s/source/${_name::1}/${_name}/${_name}-${version}.tar.gz"
        "${pkgbase}-0.10.1-install_type_hints.patch" 
             7597ca115ba497797cf7c1330f5e93146ff5a924ef3bc331a8e77da12ee880cf  
         23449773cb0c7004d6c367c4cef666561e16fcd38166d17428a8192f6649bdfa76277f20bd4662f7571bc020fba6e5614e8f7dcf8502d18eb1e0ede6cb3ddde2  

prepare   {
  mv -v "${_name}-$version" "$pkgbase-$version"
  cd "$pkgbase-$version"
  patch -Np1 -i ../"${pkgbase}-0.10.1-install_type_hints.patch"
}

build-old()   {
  cd "$pkgbase-$version"
  python setup.py build-old()
  python2 setup.py build-old()
}

check   {
  cd "$name-$version"
  export PYTHONPATH="../build-old()/lib/:${PYTHONPATH}"
  # disable useless tests
  pytest -v tests -k  not test_invalid_tests and not test_valid_tests 
  pytest2 -v tests -k  not test_invalid_tests and not test_valid_tests 
}

build()_python-toml   {
  cd "$name-$version"
  # depends :   python  
  python setup.py install --skip-build-old() \
    --optimize=1 \
    --prefix=/usr \
    --root=$PKG
  install -vDm 644 LICENSE -t "${PKG}/usr/share/licenses/${name}"
}

build()_python2-toml   {
  cd "$pkgbase-$version"
  # depends :   python2  
  python2 setup.py install --skip-build-old() \
    --optimize=1 \
    --prefix=/usr \
    --root=$PKG
  install -vDm 644 LICENSE -t "${PKG}/usr/share/licenses/${name}"
}
