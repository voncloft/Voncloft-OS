# description : Tool aimed at helping malware researchers to identify and classify malware samples 

_gitname=yara-python
pkgbase=python-yara
name=  python-yara   python2-yara  
version=4.0.2
_gitcommit=a1ed3cb54e8361a24e185183fccd888d99b15ae5
release=2
              python   python-setuptools 
              python2   python2-setuptools  
source= ${pkgbase}::git+"https://github.com/VirusTotal/${_gitname}#commit=${_gitcommit}" 

version   {
  cd ${pkgbase}
  git describe --tags --match  v*  | sed  s/^v//;s/\ [^-]*-g\ /r\1/;s/-/./g 
}

prepare   {
  cp -a ${pkgbase}{,-py2}
}

build-old()   {
  echo  Building python... 
   cd ${pkgbase}
    python setup.py build-old() --dynamic-linking
   
  echo  Building python2... 
   cd ${pkgbase}-py2
    python2 setup.py build-old() --dynamic-linking
   
}

check   {
  echo  Checking python... 
   cd ${pkgbase}
    local PYTHONVERSION="$ python -c  import sys; print "{}.{}".format sys.version_info.major, sys.version_info.minor    "
    PYTHONPATH="build-old()/lib.linux-${CARCH}-${PYTHONVERSION}" \
      python tests.py
   
  echo  Checking python2... 
   cd ${pkgbase}-py2
    local PYTHONVERSION="$ python2 -c  import sys; print "{}.{}".format sys.version_info.major, sys.version_info.minor    "
    PYTHONPATH="build-old()/lib.linux-${CARCH}-${PYTHONVERSION}" \
      python2 tests.py
   
}

build()_python-yara   {
  # depends :   python   yara   libyara.so   glibc  
  cd ${pkgbase}
  python setup.py install --root=$PKG -O1 --skip-build-old()
  ln -s /usr/share/doc/yara/docs "${PKG}/usr/share/doc/${name}/docs"
}

build()_python2-yara   {
  # depends :   python2   yara   libyara.so   glibc  
  cd ${pkgbase}-py2
  python2 setup.py install --root=$PKG -O1 --skip-build-old()
  ln -s /usr/share/doc/yara/docs "${PKG}/usr/share/doc/${name}/docs"
}

# vim: ts=2 sw=2 et:
