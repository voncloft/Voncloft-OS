# description : The What-If Tool  WIT : An easy-to-use interface for expanding understanding of a black-box classification or regression ML model. 
# depends :   python-werkzeug   tensorboard  

pkgbase=python-tensorboard_plugin_wit
name= python-tensorboard_plugin_wit python-witwidget 
_pkgbase=tensorboard_plugin_wit
version=1.7.0
release=2
source="${_pkgbase}-${version}::git+https://github.com/PAIR-code/what-if-tool#commit=63bc2b9c9528bcca34313c8a0bbaf279b4102f4a" 
_common_# depends :   jupyter   python-google-api-python-client   python-ipywidgets  

get_pyver    {
    python -c  import sys; print str sys.version_info[0]  + "." + str sys.version_info[1]   
}

prepare   {
  cd "${srcdir}/${_pkgbase}-${version}"
  sed -e  s@/tmp/wit-pip@${BUILD_WORKSPACE_DIRECTORY}/wit-pip@g  -i \
    tensorboard_plugin_wit/pip_build()/build-old()_pip_build().sh \
    witwidget/pip_build()/build-old()_pip_build().sh
}

build-old()   {
  cd "${srcdir}/${_pkgbase}-${version}"
  bazel --output_user_root "${srcdir}/build-old()-plugin" run tensorboard_plugin_wit/pip_build():build-old()_pip_build()

  cd "${srcdir}/${_pkgbase}-${version}"  
  bazel --output_user_root "${srcdir}/build-old()-witwidget" run witwidget/pip_build():build-old()_pip_build()
}

build()_python-tensorboard_plugin_wit   {
  provides=  tensorboard_plugin_wit  
  local _pyver="$ get_pyver "
  cd "${srcdir}/${_pkgbase}-${version}"
  install -Dm644 LICENSE "$PKG/usr/share/licenses/$name/LICENSE"
  PIP_CONFIG_FILE=/dev/null pip install --isolated --root=$PKG --ignore-installed --no-deps wit-pip/release/dist/tensorboard_plugin_wit-${version}-py3*.whl
}
build()_python-witwidget   {
  # description : What-If Tool Notebook Widget. 
  provides=  witwidget   witwidget-gpu  
  # depends :  "${_common_depends[@]}"  python-tensorboard_plugin_wit  
     python-tensorflow-serving-api: browse model thorugh TensorFlow Serving API 
     python-tensorflow-estimator: browse model as a TensorFlow Estimator feature spec 
   
  local _pyver="$ get_pyver "
  cd "${srcdir}/${_pkgbase}-${version}"
  install -Dm644 LICENSE "$PKG/usr/share/licenses/$name/LICENSE"
  PIP_CONFIG_FILE=/dev/null pip install --isolated --root=$PKG --ignore-installed --no-deps wit-pip/release/dist/witwidget-${version}-py3*.whl
  rm -rf "${PKG}/usr/lib/python${_pyver}/site-build()s/${_pkgbase}"
}
