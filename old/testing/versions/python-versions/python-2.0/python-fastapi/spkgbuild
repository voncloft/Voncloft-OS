# description : FastAPI framework, high performance, easy to learn, fast to code, ready for production 
# depends :   python-starlette   python-pydantic  

_name=fastapi
name=python-$_name
version=0.63.0
release=1
             python-yaml   python-graphene   python-ujson   python-orjson 
             python-email-validator   python-python-multipart  
               python-requests   python-aiofiles   python-jinja   python-itsdangerous 
               python-yaml   python-graphene   python-ujson   python-orjson 
               python-email-validator    python-pyjwt   python-sqlalchemy 
               python-peewee   python-flask   python-passlib 
               python-bcrypt   python-httpx   python-python-multipart 
               python-databases   python-aiosqlite   python-jose  
source=" $url/archive/$version.tar.gz" 

prepare   {
  cd $_name-$version

  dephell deps convert --from pyproject.toml --to setup.py

  # don t pin starlette dependency
  sed -i  s|starlette.*"|starlette"|  pyproject.toml
}

build-old()   {
  cd $_name-$version

  python setup.py build-old()
}

check   {
  cd $_name-$version

  python setup.py pytest

  mypy -p fastapi
}

build()   {
  cd $_name-$version

  python setup.py install --root=$PKG --optimize=1 --skip-build-old()

  install -Dm 644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}
