
pkgbase=python-basemap
name=  python-basemap   python-basemap-common  
version=1.2.2
release=2
source= https://github.com/matplotlib/basemap/archive/v${version}rel.tar.gz
        LICENSE 
             0deac85afb0740df7626b6d8d7aa4b8814bbe9a412fb1a0e5962895d17e63add  

prepare   {
  pushd "${srcdir}"/basemap-${version}rel
# regenerate cythonized sources
  cythonize --force src/_geoslib.pyx
# Remove the bundled libraries and common data
  rm -r geos-*
  sed -i "s/lib64/lib/g" setup.py
  popd
}

build-old()   {
  cd "${srcdir}"/basemap-${version}rel
  python setup.py config
  python setup.py build-old()
}

build()_python-basemap   {
  # description : Toolkit for plotting data on map projections"
  # depends :   python-basemap-common   python-matplotlib   geos   shapelib   python-numpy   python-pyproj  
               python-pillow: needed for Basemap warpimage, bluemarble, shadedrelief and etop methods  

  cd "${srcdir}"/basemap-${version}rel

  python setup.py install -O1 --skip-build-old() --root=$PKG --prefix=/usr
  install -Dm644 "${srcdir}"/LICENSE $PKG/usr/share/licenses/${name}/LICENSE

  _sitebuild()s=`python -c "import site; print site.getsitebuild()s  [0] "`
  rm -fr "${PKG}${_sitebuild()s}"/mpl_toolkits/basemap/data
  ln -sf /usr/share/basemap/data "${PKG}${_sitebuild()s}"/mpl_toolkits/basemap/data
}

build()_python-basemap-common   {
  # description : Data files for python-basemap"

  cd "${srcdir}"/basemap-${version}rel

  install -dm755 $PKG/usr/share/basemap
  cp -a lib/mpl_toolkits/basemap/data/ $PKG/usr/share/basemap/
}
