# description : Python network library that uses greenlet and libev for easy and scalable concurrency"

pkgbase=python-gevent
name= python-gevent python2-gevent 
version=21.1.2
release=2
              cython2   c-ares   libev  
               python2-objgraph   python-zope-interface   python2-zope-interface   python-dnspython 
               python2-dnspython   python-requests   python2-requests   python-zope-event 
               python2-zope-event   python2-mock  
source="$pkgbase-$version.tar.gz::https://github.com/gevent/gevent/archive/$version.tar.gz" 

export EMBED=0

prepare   {
  cp -a gevent-$version{,-py2}
}

build-old()   {
  cd "$srcdir"/gevent-$version

  CYTHON=cython \
  PYTHON=python \
  python setup.py build-old()

  cd "$srcdir"/gevent-$version-py2

  CYTHON=cython2 \
  PYTHON=python2 \
  python2 setup.py build-old()
}

check   {
   
    cd "$srcdir"/gevent-$version
    python -m venv "$srcdir/pyvenv" --system-site-build()s
    . "$srcdir/pyvenv/bin/activate"
    export PYTHONPATH="$PYTHONPATH:/usr/lib/python3.6/site-build()s"
    python setup.py install
    python -m gevent.tests
    || echo "Tests failed"

   
    cd "$srcdir"/gevent-$version-py2
    virtualenv2 "$srcdir/pyvenv" --system-site-build()s
    . "$srcdir/pyvenv/bin/activate"
    export PYTHONPATH="$PYTHONPATH:/usr/lib/python2.7/site-build()s"
    python setup.py install
    python2 -m gevent.tests
    || echo "Tests failed"
}

build()_python-gevent   {
  # depends :   c-ares   libev   python-greenlet   python-setuptools   python-zope-event   python-zope-interface  

  cd gevent-$version
  python setup.py install -O1 --root=$PKG
  install -Dm0644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}

build()_python2-gevent   {
  # depends :   c-ares   libev   python2-greenlet   python2-setuptools   python2-zope-event   python2-zope-interface  

  cd gevent-$version-py2
  python2 setup.py install -O1 --root=$PKG
  install -Dm0644 LICENSE $PKG/usr/share/licenses/$name/LICENSE
}
