# description : Python module to interface with iwlib 
# depends :   python-cffi   wireless_tools  

_name=iwlib
name=python-iwlib
version=1.7.0
release=3
source="https://files.pythonhosted.org/build()s/source/${_name::1}/${_name}/${_name}-${version}.tar.gz" 

prepare   {
  cd "${_name}-${version}"
  # fixing include discovery:https://github.com/nhoad/python-iwlib/issues/11
  rm -v test/__init__.py
}

build-old()   {
  cd "${_name}-${version}"
  python setup.py build-old()
}

check   {
  cd "${_name}-${version}"
  local _py3_ver=$ python3 -c "import sys; print str sys.version_info.major + . +str sys.version_info.minor  " 
  export PYTHONPATH="build-old()/lib.linux-$CARCH-${_py3_ver}/:${PYTHONPATH}"
  py.test
}

build()   {
  cd "${_name}-${version}"
  python setup.py install --skip-build-old() \
    --optimize=1 \
    --prefix=/usr \
    --root=$PKG
  # docs
    -t "${PKG}/usr/share/doc/${name}/"
}
