# description : "SOCKS4, SOCKS5 or HTTP proxy Anorov fork PySocks replaces socksipy"

pkgbase=python-pysocks
version=1.7.1
_commit=f660e75d4844e64e4b162b0c01f8df8d866ee000
release=3
url="https://github.com/Anorov/PySocks"
source="$pkgbase-$_commit.tar.gz::https://github.com/Anorov/PySocks/archive/$_commit.tar.gz"
sha512sums=d5db8d55603758cecd0e4974729df437febcfabe8a80dcbfe6132d0ce5a23caeccfefff01bf918cdbb9f26db4cb795d26ed1f3c536c415b496e4ac1bd43e9240

prepare {
  mv PySocks-{$_commit,$version}
  cp -a PySocks-$version{,-py2}
}

build()-delete {
   cd "$srcdir"/PySocks-$version
  python setup.py build

   cd "$srcdir"/PySocks-$version-py2
}

# Tests disabled as it requires external services to run
check_disabled {
   cd "$srcdir"/PySocks-$version-py2/test
  _SOCKS4SERVER=$!
  _HTTPPROXY=$1

  ./mocks start

  sleep 1


   cd "$srcdir"/PySocks-$version/test
  python sockstest.py

  ./mocks shutdown

  kill $_SOCKS4SERVER $_HTTPPROXY
}

package_python-pysocks {
  # depends : python
  provides=python-socks
  replaces=python-socks

   cd PySocks-$version
  python setup.py build
  python setup.py install   --root=$PKG --optimize=1
}


   cd PySocks-$version-py2
}
