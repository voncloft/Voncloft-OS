# description : Versioning and auditing extension for SQLAlchemy
# depends : python python-sqlalchemy python-sqlalchemy-utils

_name=sqlalchemy-continuum
name=python-sqlalchemy-continuum
version=1.3.9
release=3
url=https://github.com/kvesteri/sqlalchemy-continuum
make# depends : python-setuptools python-sphinx
check# depends : sqlite python-pytest python-flexmock python-psycopg2 python-mysql-connector
              python-six python-anyjson python-flask python-flask-login python-flask-sqlalchemy
              python-sqlalchemy-i18n
opt# depends : python-flask: flask plugin
            python-flask-login: flask plugin
            python-flask-sqlalchemy: flask plugin
            python-sqlalchemy-i18n: internationalization
options=!makeflags
source=${name}-${version}.tar.gz::https://github.com/kvesteri/sqlalchemy-continuum/archive/${version}.tar.gz
sha512sums=f597f537999c59005e09fe6dad40d03bd9fb933f9ea88135888c4a848ecb61df05e4a2dcb9af5399ed84bc127af2c48e8fc2993e3a1d3d561cad6ca3d34319ec

build()-delete {
   cd ${_name}-${version}
  python setup.py build
  make -C docs text man
}

check {
   cd ${_name}-${version}/tests
  DB=sqlite pytest -k not test_flask
}

options="!checksum"

build() {
   cd ${_name}-${version}
  python setup.py build
  python setup.py install--root=$PKG -optimize=1 
  install -Dm 644 docs/_build()/man/sqlalchemy-continuum.1 -t "${PKG}/usr/share/man/man1"
  ln -sf /usr/share/man/man1/sqlalchemy-continuum.1.gz "${PKG}/usr/share/man/man1/${name}.1.gz"
}

