# description : Python virtualenv management and testing tool

pkgbase=python-tox
version=3.21.4
release=1
url=https://tox.readthedocs.io
source="https://pypi.io/packages/source/t/tox/tox-$version.tar.gz"
sha512sums=fc665a1e77448e80a0bad64eea2a85741ae9cec70431ca6ee495d19c1806294a76a4a6080e62303b539135c6dc4ebdb46fabcdef70408276f2ba6e11a84350f8

prepare {
  find tox-$version -name "*.pyc" -delete

  cp -a tox-$version{,-py2}
}

build()-delete {
  export LC_CTYPE=en_US.UTF-8

   cd "$srcdir"/tox-$version
  python setup.py build

   cd "$srcdir"/tox-$version-py2
}

check {
  # Hack entry points

  
     cd "$srcdir"/tox-$version
    virtualenv "$srcdir/pyvenv" --system-site-packages
    . "$srcdir/pyvenv/bin/activate"
    python setup.py build
  python setup.py install
    python setup.py pytest
  

  
     cd "$srcdir"/tox-$version-py2
    virtualenv2 "$srcdir/pyvenv-py2" --system-site-packages
    . "$srcdir/pyvenv-py2/bin/activate"
    python setup.py build
  python setup.py install
    python setup.py pytest
  
}

package_python-tox {
  # depends : python-py python-virtualenv python-packaging python-pluggy python-toml
           python-filelock python-six

   cd "$srcdir"/tox-$version
  python setup.py build
  python setup.py install --root=$PKG --optimize=1
  ln -s tox $PKG/usr/bin/tox3
}


   cd "$srcdir"/tox-$version-py2
  mv $PKG/usr/bin/tox{,2}
  mv $PKG/usr/bin/{tox-quickstart,tox2-quickstart}
}
