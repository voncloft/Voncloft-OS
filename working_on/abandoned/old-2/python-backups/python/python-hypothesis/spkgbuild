# description : "Advanced Quickcheck style testing library for Python"
# depends : python-attrs python-sortedcontainers

name=python-hypothesis
version=6.1.1
release=1
url="https://hypothesis.readthedocs.org"
opt# depends : python-pytz: for datetime and django module
            python-faker: for fakefactory and django module
            python-django: for django module
            python-numpy: for numpy module
            python-pytest: for pytest module
            python-lark-parser: for lark module
            python-libcst: for codemods module
make# depends : python-setuptools
check# depends : python-pytest flake8 python-pytz python-numpy python-faker
              python-flaky python-django python-mock python-pandas python-dpcontracts
              python-pytest-xdist python-lark-parser python-pexpect python-coverage
              python-typing_extensions python-black python-fakeredis python-libcst
source="$name-$version.tar.gz::https://github.com/HypothesisWorks/hypothesis/archive/hypothesis-python-$version.tar.gz"
sha512sums=7d6ef548333b860dd868a9aa2a220191c237ac8e843cff835f423332fa561377ced29a9703cf0a49c76594a986048c1b1a1b8df5b38b2848410cfd7708168d58

prepare {
  mv hypothesis-hypothesis-python-$version hypothesis-$version
}

build()-delete {
   cd hypothesis-$version/hypothesis-python
  python setup.py build
}

check {
  # tests/numpy/test_lazy_import.py: https://github.com/HypothesisWorks/hypothesis/issues/2411

   cd hypothesis-$version/hypothesis-python
  python setup.py build
  python setup.py install --root="$PWD/tmp_install" --optimize=1
  python examples/example_hypothesis_entrypoint/setup.py install --root="$PWD/tmp_install" --optimize=1

  PYTHONPATH="$PWD/tmp_install/usr/lib/python3.9/site-packages:$PWD/examples/example_hypothesis_entrypoint" \
  PATH="$PWD/tmp_install/usr/bin:$PATH" \
    pytest --ignore tests/numpy/test_lazy_import.py --ignore tmp_install
}

options="!checksum"

build() {
   cd hypothesis-$version/hypothesis-python
  python setup.py build
  python setup.py install --root=$PKG --optimize=1

  # Its only present when tests are enabled, so adding -f
  rm -rf $PKG/usr/lib/python3.9/site-packages/tests
}
