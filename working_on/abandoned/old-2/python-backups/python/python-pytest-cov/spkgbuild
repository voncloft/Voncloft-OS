# description : py.test plugin for coverage reporting with support for both centralised and distributed testing, including subprocesses and multiprocessing

pkgbase=python-pytest-cov
version=2.11.1
release=1
url=https://github.com/schlamar/pytest-cov
source="$pkgbase-$version.tar.gz::https://github.com/pytest-dev/pytest-cov/archive/v$version.tar.gz"
sha512sums=513e89c061e926cfab718adb1a52f573abec6d67635df4ef791dc9a0e6338369c3a0771c9f2a44c5c2a17ab5a5ebc21398b4e3c525dba50724f70eea22a1c9ce

prepare {
  cp -a pytest-cov-$version{,-py2}
}

build()-delete {
   cd "$srcdir"/pytest-cov-$version
  python setup.py build

   cd "$srcdir"/pytest-cov-$version-py2
}

check {
  # Hack entry points by installing it

   cd "$srcdir"/pytest-cov-$version
  python setup.py build
  python setup.py install --root="$PWD/tmp_install" --optimize=1
  PYTHONPATH="$PWD/tmp_install/usr/lib/python3.9/site-packages:$PYTHONPATH:$PWD/tests" py.test || echo "Tests failed"

   cd "$srcdir"/pytest-cov-$version-py2
}

package_python-pytest-cov {
  # depends : python-pytest python-coverage

   cd pytest-cov-$version
  python setup.py build
  python setup.py install --root=$PKG --optimize=1
}


   cd pytest-cov-$version-py2
}
