# description : Simplified packaging of Python modules
# depends : python

_name=flit
pkgbase=python-$_name
name=$pkgbase{,-core}
version=3.0.0
release=3
url=https://github.com/takluyver/flit
make# depends : python-setuptools python-dephell
             python-requests python-docutils python-pytoml
             #python-build() python-install python-pyproject2setuppy
check# depends : python-pytest-runner python-pytest-cov python-testpath python-responses
source="$pkgbase-$version.tar.gz::$url/archive/$version.tar.gz"
sha512sums=eaac412613f18e711603ee3dcf692aa0b652cd59de726e547ab91ee96368d804dbe4f312a0c169565ff96f34dd4e72e7fccf63f719910c17955afa64d2f36485

prepare {
   cd $_name-$version

  dephell deps convert --from pyproject.toml --to setup.py

   cd flit_core

  dephell deps convert --from pyproject.toml --to setup.py
}

build()-delete {
   cd $_name-$version

  python setup.py build

   cd flit_core

  python setup.py build
}

check {
   cd $_name-$version

  python setup.py pytest
}

package_python-flit {
  depends+=python-flit-core python-requests python-docutils python-pytoml
  provides=$_name
  conflicts=$_name

   cd $_name-$version

  python setup.py build
  python setup.py install --root=$PKG --optimize=1 
  cp -a flit/license_templates $PKG/usr/lib/python3.9/site-packages/flit/

}

package_python-flit-core {
  pkgdesc+= core backend

   cd $_name-$version/flit_core

  python setup.py build
  python setup.py install --root=$PKG --optimize=1 

}
