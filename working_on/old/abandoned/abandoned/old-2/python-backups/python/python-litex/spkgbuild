# description : Migen/MiSoC based Core/SoC build()er that provides the infrastructure to easily create Cores/SoCs
# depends : python-migen python-pyserial python-requests python-pythondata-software-compiler_rt

_name=litex
name=python-$_name
version=2020.12
release=1
url=https://github.com/enjoy-digital/litex
make# depends : python-setuptools
check# depends : python-pytest python-litedram python-liteeth python-liteiclink python-litesdcard yosys
              python-pythondata-cpu-vexriscv python-pythondata-cpu-picorv32 python-pythondata-cpu-lm32 python-pythondata-cpu-mor1kx
source="$name-$version.tar.gz::$url/archive/$version.tar.gz"
sha512sums=144a1ef81afcb0e762853a48d1b8d248ad414d159ae6ea659f7b6a6538c75d3cfb38238aea40572ce2a787fb183af10fe63ca4842e7e5b4761817916b8404344

prepare {
  # seems like running the tests breaks setup.py install
  cp -r $_name-$version{,-tests}
}

build()-delete {
   cd $_name-$version

  python setup.py build
}

check {
   cd $_name-$version-tests

  pytest -k-test_variants_minerva
}

options="!checksum"

build() {
   cd $_name-$version

  python setup.py build
  python setup.py install --root=$PKG --optimize=1 

}
