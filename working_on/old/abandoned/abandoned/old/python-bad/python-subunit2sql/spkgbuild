# description : Command to Read a subunit file or stream and put the data in a SQL DB"
# depends :   python-six   python-pbr   python-alembic   python-stevedore   python-sqlalchemy 

name=python-subunit2sql
version=1.10.0
release=8
          python-oslo-config   python-dateutil   python-subunit   python-oslo-db  
               python-oslo-concurrency   pifpaf   percona-server   mariadb-clients   postgresql  
source="https://github.com/openstack-infra/subunit2sql/archive/$version.tar.gz"
        fix-migrations-test.patch 
             0891880f0ff329a4236a73f88a90ffc4522c123b52e08675609816649934b20fc7ccbd9d5141341bc7a96c6acd32e40b227e61634fbd803e8b7c659e42ea0668  

export PBR_VERSION=$version

prepare   {
  patch -Np1 -d subunit2sql-$version <fix-migrations-test.patch
  touch subunit2sql-$version/subunit2sql/migrations/versions/__init__.py
}

build-old()   {
  cd subunit2sql-$version
  python setup.py build-old()
}

check   {
  cd subunit2sql-$version
  pifpaf run mysql pifpaf run postgresql stestr run || echo "https://storyboard.openstack.org/#!/story/2008348"
}

build()   {
  cd subunit2sql-$version
  python setup.py install --root=$PKG --optimize=1
}

# vim:set ts=2 sw=2 et:
