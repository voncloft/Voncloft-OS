# description : SOCKS4, SOCKS5 or HTTP proxy  Anorov fork PySocks replaces socksipy "

pkgbase=python-pysocks
name= python-pysocks python2-pysocks 
version=1.7.1
_commit=f660e75d4844e64e4b162b0c01f8df8d866ee000
release=3
source="$pkgbase-$_commit.tar.gz::https://github.com/Anorov/PySocks/archive/$_commit.tar.gz" 

prepare   {
  mv PySocks-{$_commit,$version}
  cp -a PySocks-$version{,-py2}
}

build-old()   {
  cd "$srcdir"/PySocks-$version
  python setup.py build-old()

  cd "$srcdir"/PySocks-$version-py2
  python2 setup.py build-old()
}

# Tests disabled as it requires external services to run
check_disabled   {
  cd "$srcdir"/PySocks-$version-py2/test
  python2 socks4server.py &
  _SOCKS4SERVER=$!
  python2 httpproxy.py &
  _HTTPPROXY=$1

  ./mocks start

  sleep 1

  python2 sockstest.py

  cd "$srcdir"/PySocks-$version/test
  python sockstest.py

  ./mocks shutdown

  kill $_SOCKS4SERVER $_HTTPPROXY
}

build()_python-pysocks   {
  # depends :   python  
  provides=  python-socks  
  replaces=  python-socks  

  cd PySocks-$version
  python setup.py install --prefix=/usr --root=$PKG --optimize=1
  install -Dm644 LICENSE -t $PKG/usr/share/licenses/$name/
}

build()_python2-pysocks   {
  # depends :   python2  
  provides=  python2-socks  
  replaces=  python2-socks  

  cd PySocks-$version-py2
  python2 setup.py install --prefix=/usr --root=$PKG --optimize=1
  install -Dm644 LICENSE -t $PKG/usr/share/licenses/$name/
}
