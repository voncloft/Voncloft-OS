
pkgbase=python-psutil
name=  python-psutil   python2-psutil  
version=5.8.0
release=1
source="https://github.com/giampaolo/psutil/archive/release-$version.tar.gz" 

build-old()   {
  cd psutil-release-$version

  python setup.py build-old() --build-old()-lib=build-old()/python

  python2 setup.py build-old() --build-old()-lib=build-old()/python2
  find build-old()/python2 -type f -exec \
    sed -i  1s,^#! \?/usr/bin/\ env \|\ python$,#!/usr/bin/python2,  {} \;
}

check   {
  cd psutil-release-$version

  # Required for testing
#cp setup.py build-old()/python
#cp -r scripts build-old()/python/

# 4 non-working tests in build-old() chroot, requires fixes. Test framework does not allow exclusion.
#  PYTHONPATH="$PWD/build-old()/python" python psutil/tests/__main__.py
}

build()_python-psutil   {
  # description : A cross-platform process and system utilities module for Python 
  # depends :   python  

  cd psutil-release-$version
  python setup.py build-old() --build-old()-lib=build-old()/python \
                  install --root=$PKG --optimize=1
  install -D -m 644 LICENSE "$PKG/"usr/share/licenses/$name/LICENSE
}

build()_python2-psutil   {
  # description : A cross-platform process and system utilities module for Python2 
  # depends :   python2  

  cd psutil-release-$version
  python2 setup.py build-old() --build-old()-lib=build-old()/python2 \
                   install --root=$PKG --optimize=1
  install -D -m 644 LICENSE "$PKG/"usr/share/licenses/$name/LICENSE
}

# vim:set ts=2 sw=2 et:
