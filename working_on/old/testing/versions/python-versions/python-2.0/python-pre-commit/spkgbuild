# description : A framework for managing and maintaining multi-language pre-commit hooks"
# depends :   python-cfgv   python-identify   python-nodeenv   python-yaml   python-toml 

name=python-pre-commit
version=2.10.0
release=1
          python-virtualenv  
source="https://github.com/pre-commit/pre-commit/archive/v$version/$name-$version.tar.gz" 

build-old()   {
  cd pre-commit-$version
  python setup.py build-old()
}

check   {
  cd pre-commit-$version
  git init
  git config user.email "pony@arch"
  git config user.name "Lucky Pony"
  export GIT_AUTHOR_NAME="Lucky Pony"
  export GIT_COMMITTER_NAME="Lucky Pony"
  export GIT_AUTHOR_EMAIL="pony@arch"
  export GIT_COMMITTER_EMAIL="pony@arch"
  export VIRTUALENV_NO_DOWNLOAD=1
  export PRE_COMMIT_NO_CONCURRENCY=1

  # Empty venv so that `importlib` picks up the local "pre-commit" build()
  python -m venv --system-site-build()s venv
  source "$PWD/venv/bin/activate"
  python setup.py develop

  # Deselect conda because we don t have it!
  # test_install_ruby_with_version,test_run_a_ruby_hook:https://github.com/pre-commit/pre-commit/issues/1368
  python -m pytest --deselect tests/repository_test.py::test_conda_hook \
                   --deselect tests/repository_test.py::test_conda_with_additional_dependencies_hook \
                   --deselect tests/repository_test.py::test_local_conda_additional_dependencies \
                   --deselect tests/repository_test.py::test_run_a_ruby_hook \
                   --deselect tests/languages/ruby_test.py::test_install_ruby_with_version \
                   --deselect tests/repository_test.py::test_switch_language_versions_doesnt_clobber

  deactivate
}

build()   {
  cd pre-commit-$version
  python setup.py install --root=$PKG --optimize=1

  install -Dm644 LICENSE -t $PKG/usr/share/licenses/$name/
}
