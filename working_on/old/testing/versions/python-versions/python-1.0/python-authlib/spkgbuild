
_name=authlib
name=python-authlib
version=0.15.2
_commit=1969b567733f6426e5a8e20c5edf3371e9d23e5c
release=3
# description : The ultimate Python library in building OAuth and OpenID Connect servers"
# depends :   python-cryptography  
               python-django   python-flask-sqlalchemy   python-httpx   python-starlette  
source="git+${url}.git#commit=${_commit}?signed" 
validpgpkeys=  72F8E895A70CEBDF4F2ADFE07E55E3E0118B2B4C   # Hsiaoming  UJET  <lepture@ujet.co>

version   {
    cd "${srcdir}"/${_name}

    git describe --exact-match --tags | sed  s/^v// 
}

prepare   {
    cd "${srcdir}"/${_name}

    # no need to install an additional copy of the stdlib
    find tests -name \*.py -exec sed -i  s/^import mock$/from unittest import mock/  {} +
}

build   {
    cd "${srcdir}"/${_name}

    python setup.py build
}

check   {
    cd "${srcdir}"/${_name}

    # Some tests fail is run with Django with Flask tests
    #https://github.com/lepture/authlib/issues/284
    python -m pytest --ignore tests/django --ignore tests/flask
    python -m pytest tests/django
    python -m pytest tests/flask
}

package   {
    cd "${srcdir}"/${_name}

    python setup.py install --root=$PKG --optimize=1 --skip-build
    install -Dm644 LICENSE $PKG/usr/share/licenses/${name}/LICENSE
}
