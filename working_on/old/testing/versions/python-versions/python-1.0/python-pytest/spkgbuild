
name=python-pytest
version=6.2.1
release=1
# description : Simple powerful testing with Python"
# depends :   python-attrs   python-iniconfig   python-more-itertools   python-packaging   python-pluggy 
          python-py   python-toml  
               python-xmlschema 
              # Unlisted, but actually used. Check again after a while:
               python-decorator   python-docutils   python-jinja   python-numpy   python-pexpect 
               python-pygments   python-twisted   python-pytest-xdist  
source="https://github.com/pytest-dev/pytest/archive/$version.tar.gz" 

export SETUPTOOLS_SCM_PRETEND_VERSION=$version

prepare   {
  sed -i  /_pytest.warning_types.PytestUnknownMarkWarning/a \    "ignore:Creating a LegacyVersion has been deprecated and will be removed in the next major release:DeprecationWarning"  pytest-$version/pyproject.toml
}

build   {
  cd pytest-$version
  python setup.py build
}

check   {
  cd pytest-$version
  python setup.py egg_info
  # pdb tests:https://github.com/pytest-dev/pytest/issues/8161
  PYTHONPATH="$PWD"/build/lib python src/pytest/__main__.py --deselect testing/test_debugging.py::TestPDB::test_pdb_interaction_doctest \
                                                            --deselect testing/test_debugging.py::TestPDB::test_pdb_with_injected_do_debug \
                                                            --deselect testing/test_debugging.py::TestPDB::test_pdb_continue_with_recursive_debug \
                                                            --deselect testing/test_debugging.py::test_pdb_suspends_fixture_capturing
}

package   {
  cd pytest-$version
  python setup.py install --root=$PKG --optimize=1
  install -D -m644 LICENSE -t $PKG/usr/share/licenses/$name/
}
