
name=python-jedi
_gitcommit=3b7106ae71cb7bd3431101d169a0110ee0c179aa
version=0.17.2
release=3
# description : Awesome autocompletion for python"
# depends :   python   python-parso  
source="git+https://github.com/davidhalter/jedi#commit=${_gitcommit}"
        jedi-0.17.2-py39.patch
        git+https://github.com/davidhalter/typeshed
        git+https://github.com/typeddjango/django-stubs 
             9b5c13800f29f4c6954d63c0989210cc173162803e8546bfe084a975e3e25208 
             SKIP 
             SKIP  

version   {
  cd jedi
  git describe --tags --match  v*  | sed  s/^v//;s/\ [^-]*-g\ /r\1/;s/-/./g 
}

prepare   {
  cd jedi
  git submodule init
  git config submodule."jedi/third_party/typeshed".url "${srcdir}/typeshed"
  git config submodule."jedi/third_party/django-stubs".url "${srcdir}/django-stubs"
  git submodule update --recursive

  # two patches for Python 3.9 cherry-picked from upstream s master branch
  patch -Np1 -i ../jedi-0.17.2-py39.patch
}

build   {
  cd jedi
  python setup.py build
  sphinx-build -b text docs docs/_build/text
  sphinx-build -b man docs docs/_build/man
}

check   {
  cd jedi
  # skip pytest 6 test issueshttps://github.com/davidhalter/jedi/issues/1660
  # these are also skipped in upstream s Travis CI
  pytest test -k  not test_completion[pytest 
}

package   {
  cd jedi
  python setup.py install --root=$PKG --optimize=1 --skip-build
  install -Dm 644 LICENSE.txt -t "$PKG/usr/share/licenses/$name"
  install -Dm 644 docs/_build/man/jedi.1 "$PKG/usr/share/man/man1/$name.1"
}

# vim: ts=2 sw=2 et:
