#!/bin/bash

# Default log file path
default_log="/var/log/dnsmasq.log"

# Use provided argument or default to /var/log/dnsmasq.log
logfile="${1:-$default_log}"

# Check if the log file exists
if [ ! -f "$logfile" ]; then
  echo "Log file not found: $logfile"
  exit 1
fi

# Extract domains from lines with NXDOMAIN:
# 1. Filter lines containing "NXDOMAIN".
# 2. Extract valid domain names.
# 3. Normalize to lowercase.
# 4. Count and sort results.

grep "NXDOMAIN" "$logfile" | \
awk '{for (i=1; i<=NF; i++) if ($i ~ /^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/) print tolower($i)}' | \
sort | uniq -c | sort -nr
