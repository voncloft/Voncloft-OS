sudo bash -c '
while true; do
  conntrack -L 2>/dev/null \
    | sed "/^conntrack v/d; /flow entries have been shown/d" \
    | awk '"'"'
{
  proto=$1; src=""; dst=""; sport=""; dport=""; icmp_type=""; icmp_code=""; icmp_id="";
  
  # Extract common fields
  for (i=1;i<=NF;i++) {
    if ($i ~ /^src=/ && src=="") src=substr($i,5);
    if ($i ~ /^dst=/ && dst=="") dst=substr($i,5);
    if ($i ~ /^sport=/ && sport=="") sport=substr($i,7);
    if ($i ~ /^dport=/ && dport=="") dport=substr($i,7);
    if ($i ~ /^type=/ && proto=="icmp") icmp_type=substr($i,6);
    if ($i ~ /^code=/ && proto=="icmp") icmp_code=substr($i,6);
    if ($i ~ /^id=/ && proto=="icmp") icmp_id=substr($i,4);
  }

  # Only show connections from local subnet to outside (or internal if you prefer)
  if (src ~ /^192\.168\.|^10\.|^172\.(1[6-9]|2[0-9]|3[0-1])\./) {
    if (proto=="icmp") {
      printf "%s is talking to %s over icmp (type=%s code=%s id=%s)\n", src, dst, icmp_type, icmp_code, icmp_id;
    } else if (proto=="tcp" || proto=="udp") {
      cmd = "getent hosts " dst " | awk \"{print $2}\"";
      cmd | getline host;
      close(cmd);
      if (host == "") host = dst;
      printf "%s:%s is talking to %s   %s:%s over %s\n", src, sport, dst, host, dport, proto;
    }
  }
}
'"'"'
  sleep 0.1
done
'
