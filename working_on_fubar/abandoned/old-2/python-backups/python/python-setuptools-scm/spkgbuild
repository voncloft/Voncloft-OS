# description : "Handles managing your python package versions in scm metadata."

pkgbase=python-setuptools-scm
version=5.0.1
release=1
url="https://github.com/pypa/setuptools_scm"
source="https://pypi.io/packages/source/s/setuptools_scm/setuptools_scm-$version.tar.gz"
sha512sums=055403539a26caeb119f3d6623e7b32ef52ccc11a39757fdd9b265ba191265346be5a062a5926a381ba47bbd1a666ffa632653ee6055050689cc38fe0f90cd0f

prepare {
  # https://github.com/pypa/setuptools/issues/2466
  sed -i s/filterwarnings=error/filterwarnings =\n    error\n    ignore:Creating a LegacyVersion has been deprecated and will be removed in the next major release:DeprecationWarning/ \
      setuptools_scm-$version/tox.ini
  sed -i /jaraco.windows/d setuptools_scm-$version/{setup.cfg,src/setuptools_scm.egg-info/requires.txt}
  cp -a setuptools_scm-$version{,-py2}
}

build()-delete {
   cd "$srcdir"/setuptools_scm-$version
  python setup.py build
  python setup.py egg_info

   cd "$srcdir"/setuptools_scm-$version-py2
}

check {
  # Hack entry points by installing it

   cd "$srcdir"/setuptools_scm-$version
  python setup.py build
  python setup.py install --root="$PWD/tmp_install" --optimize=1
  PYTHONPATH="$PWD/tmp_install/usr/lib/python3.9/site-packages:$PYTHONPATH" py.test

   cd "$srcdir"/setuptools_scm-$version-py2
}

package_python-setuptools-scm {
  # depends : python-setuptools
  provides=python-setuptools_scm
  conflicts=python-setuptools_scm
  replaces=python-setuptools_scm

   cd "$srcdir"/setuptools_scm-$version
  python setup.py build
  python setup.py install --root $PKG

}


   cd "$srcdir"/setuptools_scm-$version-py2

}
