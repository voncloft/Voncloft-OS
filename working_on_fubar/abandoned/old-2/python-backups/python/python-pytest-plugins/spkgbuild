
pkgbase=python-pytest-plugins
name=python-pytest-fixture-config python-pytest-shutil python-pytest-virtualenv
version=1.7.0
release=6
url=https://github.com/manahl/pytest-plugins
make# depends : python-pytest python-setuptools-git python-pypandoc python-execnet python-path.py
             python-mock python-virtualenv python-termcolor
source="$pkgbase-$version.tar.gz::https://github.com/manahl/pytest-plugins/archive/v$version.tar.gz"
sha512sums=6ce64f554359ae8b4e8b1cdab9908226501bad1d6bcdec9d7968133bbf0b3530842883cf3ea7ef14e09372fd1454d685d4b1bf4e8d95498b69a8b0f20177e2be

prepare {
  # New pypandoc?
  sed -i "s/rst/rst, format=markdown/" pytest-plugins-$version/common_setup.py

  # Our /bin is a symlink
  sed -i "s|/bin|/usr/bin|" pytest-plugins-$version/pytest-shutil/tests/integration/test_cmdline_integration.py

  # Pytest 4
  sed -i s/< *4.0/<5/ pytest-plugins-$version/pytest-*/setup.py

   cd pytest-plugins-$version; make copyfiles

  sed -i /contextlib2/d pytest-plugins-$version/pytest-shutil/setup.py
}

build()-delete {
  for _pkg in pytest-fixture-config pytest-shutil pytest-virtualenv; do
     cd "$srcdir"/pytest-plugins-$version/$_pkg
    python setup.py build
  done
}

check {
  # Hack entry points by installing it

  for _pkg in pytest-fixture-config pytest-shutil pytest-virtualenv; do
     cd "$srcdir"/pytest-plugins-$version/$_pkg
    python setup.py build
  python setup.py install --root="$srcdir"/tmp_install --optimize=1
    PYTHONPATH="$srcdir"/tmp_install/usr/lib/python3.9/site-packages py.test
  done
}

package_python-pytest-fixture-config {
  # description : Fixture configuration utils for py.test
  # depends : python-pytest

   cd pytest-plugins-$version/pytest-fixture-config
  python setup.py build
  python setup.py install --root=$PKG --optimize=1
}

package_python-pytest-shutil {
  # description : A goodie-bag of unix shell and environment tools for py.test
  # depends : python-pytest python-execnet python-path.py python-mock python-termcolor

   cd pytest-plugins-$version/pytest-shutil
  python setup.py build
  python setup.py install --root=$PKG --optimize=1
}

package_python-pytest-virtualenv {
  # description : Virtualenv fixture for py.test
  # depends : python-pytest-fixture-config python-pytest-shutil python-virtualenv

   cd pytest-plugins-$version/pytest-virtualenv
  python setup.py build
  python setup.py install --root=$PKG --optimize=1
}

